<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> a blog by victor powell</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
  </head>
  <body>
    <div class="container"><br><a href="/">back</a>
      <div class="post-body">
        <div class="container">  <style type="text/css">
    #central-limit-therom-vis .ball{
      fill: steelblue;
      opacity: 1;
      stroke: #fff;
    }

    #central-limit-therom-vis .bar rect {
      fill: steelblue;
      shape-rendering: crispEdges;
    }

    #central-limit-therom-vis .bar text {
      fill: #fff;
    }

    #central-limit-therom-vis .axis path, #central-limit-therom-vis .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
    #central-limit-therom-vis .triangle{
      stroke-linejoin: round;
      stroke: black;
      fill: black;
      stroke-width: 4;
    }
  </style>
  <label> delay </label>
  <input type="number" name="speed" min="0" max="1000" value="500" step="100">
  <label> bins </label>
  <input type="number" name="bins" min="1" max="25" value="5">
  <br />
  <br />
  <div id="central-limit-therom-vis"></div>
  <script src="http://d3js.org/d3.v3.min.js?clear"></script>
  <script type="application/javascript">
    function lvl(d){
      // given a triangle element index, calculate it's y depth within
      // the larger peramind of triangles
      d = d + 1
      var i = 0, n = 1
      while(i + n < d){
        i += n
        n++
      }
      return n - 1
    }
    
    function pos(l){
      // give a y level depth within the peramind of triangles, calculate
      // the first triangle element index at that level
      l = l + 1
      var n = 0, i = 0
      while( n < l) { i += n; n++ }
      return i
    }
    var speed = 500
      , step
      , histogram_height = 100
    
    function init(bins, width){
      var margin = { left : width/10, right : width/10, top : 10 , bottom : 30 }
        , height = 450
        , sx = (width - margin.left - margin.right) / bins
        , sy = (height - histogram_height - margin.bottom -  100 ) / bins
        , histogram_y = height - histogram_height - margin.bottom
        , values = []
        , ts = sy/3
        , bs = sy/2
        , dropping = true

      var container = d3.select('#central-limit-therom-vis')
      d3.select('#central-limit-therom-vis').selectAll('svg').remove()
      var svg = container.append('svg')
        .attr('height', height + 'px')
        .attr('width', width + 'px')
      console.log('svg', svg)
      var g = svg.append('g')
        .attr('transform', 'translate(' + (width / 2) + ',20)')

      var path = g.selectAll('path')
      path.data(d3.range(0, pos(bins + 1)))
        .enter()
          .append('g')
            // position the triangles
            .attr('transform', function(d){
              var x = 0
              var y = 0
              var l = 0
              y = lvl(d)
              x = d - pos(y) + 1
              l = (y + 2) * sx / 2
              return 'translate(' + (sx * x - l) + ', ' +  (sy *  y ) + ')'
            })
            // draw the triangles
            .append('path')
              .attr('class', 'triangle')
              .attr('d', 'M -' + (ts) + ' ' + (ts) + ' L ' + (ts) + ' ' + (ts) + ' L 0 -' + (ts/2) +' Z')

      step = function(){
        // drop a ball
        g.append('circle')
         .datum({lvl: -1, pos: 0})
         .attr('class', 'ball')
         .attr('r', (bs) + 'px')
         .attr('cx', function(d){ return (d.pos * sx / 2) + 'px' })
         .attr('cy', function(d){ return (d.lvl * sy - 50) + 'px' })
         .style('display', 'none')
         .transition()
         .style('display','block')
         .each('end', animate)
      }

      function animate(){
        var c = d3.select(this)
        var d = c.datum()
        if(d.lvl > bins - 2) {
          // drop the ball into its histogram bin
          c.transition()
            .duration(speed / 2)
            .attr('cy', function(d){ return (d.lvl * sy + 20 + histogram_height) + 'px'})
            .style('opacity', '0.0')
            .remove() // remove the balls once they're invisible
          values.push( bins / 2 + d.pos / 2)
          update()
          return
        }
        if(d.lvl === -1) d.pos = 0 // when the ball drops into the first position
        else if( Math.random() > 0.5 ) d.pos++
        else d.pos--
        d.lvl++
        c.datum(d)
        c.transition()
          .ease('bounce')
          .attr('cx', function(d){ return (d.pos * sx / 2) + 'px' })
          .attr('cy', function(d){ return (d.lvl * sy + sy) + 'px' })
          .each('end', animate)
        .duration(speed)
      }

      var x = d3.scale.linear()
          .domain([0, bins])
          .range([0, width - margin.left - margin.right])
      var formatCount = d3.format(",.0f")
      var data = d3.layout.histogram().bins(d3.range(0,bins + 1))(values)
      var histogram = d3.select('svg')
        .append('g')
        .attr('transform','translate(' + margin.left + ',' + histogram_y + ')')

      var xAxis = d3.svg.axis()
        .scale(x)
        .ticks(bins)
        .orient('bottom')

      var bar = histogram.selectAll('.bar')
        .data(data)
        .enter().append('g')
          .attr('class', 'bar')

      bar.append('rect')
        .attr('x', 1)
        .attr('width', x(data[0].dx) - 1)

      bar.append('text')
        .attr('dy', '.5em')
        .attr('y', 10)
        .attr('x', x(data[0].dx) / 2)
        .attr('text-anchor', 'middle')

      histogram.append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + (histogram_height) + ')')
        .call(xAxis)

      function update(){
        data = d3.layout.histogram().bins(d3.range(0, bins + 1))(values)
        var bar = histogram.selectAll('.bar')
        var y = d3.scale.linear()
          .domain([0, d3.max(data.map(function(d){ return d.y }))])
          .range([histogram_height, 0])
        bar.data(data)
          .transition()
          .duration(speed)
          .attr('transform', function(d){ return 'translate(' + x(d.x) + ',' + y(d.y) + ')' })
          .select('rect')
            .attr('height', function(d){ return (histogram_height - y(d.y)) })
        bar.select('text')
          .text(function(d){ return Math.floor(d.y / values.length * 100) + '%' })
      }
      update()
    }
    
    ;(function interval(){
      if(step) step()
      setTimeout(interval, speed)
    })()
    
    
    // setup buttons
    document.getElementsByName('speed')[0].onchange = function(e){
      speed = e.target.value
    }
    document.getElementsByName('bins')[0].onchange = restart;
    
    function restart(e){
      init(Number( e ? e.target.value : 5), Number(document.getElementById('central-limit-therom-vis').offsetWidth))
    }
    
    restart()
    
  </script><h3><a href="/posts/central-limit-theorem.html">Central Limit Theorem Visualized in D3</a></h3>
<p>May 29, 2013</p>
<blockquote>
<p>In probability theory, the central limit theorem (CLT) states that, given certain conditions, the mean of a sufficiently large number of independent random variables, each with a well-defined mean and well-defined variance, will be approximately normally distributed. </p>
<p>-- <a href="http://en.wikipedia.org/wiki/Central_limit_theorem">Central Limit Theorem - Wikipedia</a></p>
</blockquote>
<p>which is what we see here. at every triangle, the ball has a 50/50 shot of going to the left or to the right. you can also think of it like coin flips, where the number of coin flips is <code>(bins -1)</code></p>
<p>if we assign heads, 0, and tails 1 (or 0 for left, 1 for right in the case of the visualization above)</p>
<p>for 1 coin flip, the possible values are:</p>
<pre><code>0 -&gt; 0
1 -&gt; 1</code></pre>
<p>so for 1 coin flip, theirs 2 different possible outcomes, each quality likely. the expected percentage of the possible outcomes is than:</p>
<pre><code>0: 50%
1: 50%</code></pre>
<p>for 2 coin flips, the possible outcomes are:</p>
<pre><code>0 + 0 -&gt; 0
0 + 1 -&gt; 1
1 + 0 -&gt; 1
1 + 1 -&gt; 2</code></pre>
<p>so for 2 coin flips, theirs 3 different possible outcomes. But unlike the other outcomes, the outcome where the coins total 1, is possible in two coin combinations so the probably is double in that case. Our expect percentages would than look like:</p>
<pre><code>0: 25%
1: 50%
3: 25%</code></pre>
<p>give it a try!</p>
<p>note: this visualization was inspired by: <a href="http://vis.supstat.com/2013/04/bean-machine/"><a href="http://vis.supstat.com/2013/04/bean-machine/">http://vis.supstat.com/2013/04/bean-machine/</a></a></p>

        </div>
        <div class="clear"></div>
      </div><br>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE */
        var disqus_shortname = 'vicapow'; // required: replace example with your forum shortname
        /* DON'T EDIT BELOW THIS LINE */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments</noscript><a href="/">back</a>
    </div>
    <script src="/js/main.js"></script><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39250901-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>