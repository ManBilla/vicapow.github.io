<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> a blog by victor powell</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
  </head>
  <body>
    <div class="container"><br><a href="/">back</a><div style="float:right">
  <a href="https://twitter.com/vicapow" class="twitter-follow-button" data-show-count="false">Follow @vicapow</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
      <div class="post-body"><style>
  .graph{
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }
  .bar { 
    background-color: steelblue;
    position: absolute;
    border-left: 1px solid #fff;
    margin-left: -1px;
  }

  .bar .bar-label {
    font-size: 2em;
    position: absolute;
    color: #fff;
    width: 30em;
    left: -15em;
    text-align: center;
    background-color: none;
  }

  .bar .bar-label.x-axis{
    font-size: 1.2em;
  }

  .reanchor {
    position: absolute;
    left: 50%;
    width: 1px;
    height: 1px;
  }

  .axis path, .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }
  #responsive-container{
    width: 100%;
    height: 500px;
  }
</style>
<div id="responsive-container"></div>
<script src="http://d3js.org/d3.v3.min.js?clear"></script>
<script type='text/javascript'>
  // inspired by: http://bl.ocks.org/mbostock/3048450
  // dhm function from: http://stackoverflow.com/questions/8528382/javascript-show-milliseconds-as-dayshoursmins-without-seconds
  function dhm(t){
      var cd = 24 * 60 * 60 * 1000,
          ch = 60 * 60 * 1000,
          d = Math.floor(t / cd),
          h = '0' + Math.floor( (t - d * cd) / ch),
          m = '0' + Math.round( (t - d * cd - h * ch) / 60000);
      return [d, h.substr(-2), m.substr(-2)].join(':');
  }
  d3.json('/examples/sleepdata.json', function(err, values){
    if(err) throw err
    // pluck only the sleep duration data
    values = values.map(function(d){ return d.duration})
    var formatCount = d3.format(',.0f');

    var x = d3.scale.linear()
      .domain([d3.min(values), d3.max(values)])
      .range([0, 100]);

    var data = d3.layout.histogram()
      .bins(x.ticks(10))(values);
    
    // adjust the domain of the x axis
    x.domain([data[0].x, data[data.length-1].x + data[data.length-1].dx])
    
    var y = d3.scale.linear()
      .domain([0, d3.max(data, function(d){ return d.y; })])
      .range([0, 100]);

    var graph = d3.select('#responsive-container').append('div')
      .attr('class', 'graph')

    var bar = graph.selectAll('.bar')
      .data(data)
      .enter()
        .append('div')
          .attr('class', 'bar')
          .style('width', (x(data[0].dx) - x(0)) + '%')
          .style('height', function(d){ return y(d.y) + '%'; })
          .style('left', function(d){ return x(d.x) + '%'; })
          .style('bottom', '0')

    // top label
    bar.append('div')
      .attr('class', 'reanchor')
      .style('top', '0.5em')
      .append('div')
        .attr('class', 'bar-label')
        .attr('x', (x(data[0].dx) - x(0)) / 2 )
        .text(function(d){ return formatCount(d.y); })
    
    // bottom label
    bar.append('div')
      .attr('class', 'reanchor')
      .style('bottom', '30px')
      .append('div')
        .attr('class', 'bar-label x-axis')
        .attr('x', (x(data[0].dx) - x(0)) / 2 )
        .text(function(d){ return dhm(d.x) + ' - ' + dhm(d.x + d.dx); })
    
    graph.append('p')
      .style('text-align','right')
      .style('font-size', '2em')
      .text('my sleep duration. n = 50')
    
    // reset em's relative to the width of the document
    function resize(){
      console.log('resize')
      var graph = document.getElementsByClassName('graph')[0]
      graph.style.fontSize = (graph.offsetWidth / 75) + 'px';
    }
    window.onresize = resize
    resize()
  });
</script><h3><a href="/posts/responsive-d3.html">Responsive D3</a></h3>
<p>May 15, 2013</p>
<ul>
<li><strong>note:</strong> Resize the page to see the effect</li>
</ul>
<h2>So what techniques make this possible?</h2>
<h3>1. don&#39;t use svg!</h3>
<p>  I know this seems to goes against idiomatic d3 but remember that d3 is</p>
<blockquote>
<p>...not a monolithic framework that seeks to provide every conceivable feature. Instead, D3 solves the crux of the problem: efficient manipulation of documents based on data. </p>
</blockquote>
<p>  And that&#39;s exactly what we&#39;re doing here except with non-svg DOM elements because of the lack of support for percentage based positioning of svg elements. (if you&#39;ve found a better technique, please let me know!) </p>
<p>  <strong>update</strong>: After writing this blog post, I found an example that does achieve a similar effect with svg elements using the the <code>preserveAspectRatio=&quot;none&quot;</code> <code>&lt;svg&gt;</code> property in combination with <code>vector-effect: non-scaling-stroke</code> on <code>&lt;path&gt;</code> elements</p>
<h3>2. use container divs</h3>
<p>  A common pattern that I often see is trying to center align relative to a percentage distance from a parent element. for these cases, you can use an extra wrapper or container div</p>
<pre><code class="lang-css">.label-container{
  width: 1px;
  height: 1px;
  position: absolute;
  left: 50%;
}
.label-container .label{
  width: 100px;
  position: absolute;
  left: -50px; /* half of the width */
  text-align: center;
}</code></pre>
<h3>3. Use &#39;em&#39; not &#39;px&#39; !</h3>
<p>  This will allow text elements to resize automatically when the font-size of their parent element changes. Then, when the window resizes, you can update the font size of the parent element like so:</p>
<pre><code class="lang-js">  window.onresize = function(){
    var graph = document.getElementsByClassName(&#39;graph&#39;)[0]
    graph.style.fontSize = (graph.offsetWidth / 75) + &#39;px&#39;
  }</code></pre>

        <div class="clear"></div>
      </div><br>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE */
        var disqus_shortname = 'vicapow'; // required: replace example with your forum shortname
        /* DON'T EDIT BELOW THIS LINE */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments</noscript><a href="/">back</a>
    </div>
    <script src="/js/main.js"></script><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39250901-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>